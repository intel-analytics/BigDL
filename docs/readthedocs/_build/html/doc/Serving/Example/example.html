<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cluster Serving Example &mdash; BigDL  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
        <script src="../../../_static/design-tabs.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Cluster Serving FAQ" href="../FAQ/faq.html" />
    <link rel="prev" title="Inference by Cluster Serving" href="../ProgrammingGuide/serving-inference.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> BigDL
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Quick Start</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Orca/QuickStart/orca-tf-quickstart.html">TensorFlow 1.15 Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Orca/QuickStart/orca-keras-quickstart.html">Keras 2.3 Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Orca/QuickStart/orca-tf2keras-quickstart.html">TensorFlow 2 Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Orca/QuickStart/orca-pytorch-quickstart.html">PyTorch Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Ray/QuickStart/ray-quickstart.html">RayOnSpark Quickstart</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../UserGuide/python.html">Python User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../UserGuide/scala.html">Scala User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../UserGuide/colab.html">Colab User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../UserGuide/docker.html">Docker User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../UserGuide/hadoop.html">Hadoop/YARN User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../UserGuide/k8s.html">K8s User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../UserGuide/databricks.html">Databricks User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../UserGuide/develop.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../UserGuide/known_issues.html">BigDL Known Issues</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Nano</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Nano/Overview/nano.html">Nano User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Nano/Overview/windows_guide.html">Windows User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Nano/QuickStart/pytorch_train.html">BigDL-Nano PyTorch Training Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Nano/QuickStart/pytorch_inference.html">BigDL-Nano PyTorch Inference Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Nano/QuickStart/tensorflow_train.html">BigDL-Nano TensorFlow Training Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Nano/QuickStart/tensorflow_inference.html">BigDL-Nano TensorFlow Inference Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Nano/QuickStart/hpo.html">AutoML Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Nano/Overview/known_issues.html">Nano Known Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Nano/QuickStart/index.html">Nano Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">DLlib</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../DLlib/Overview/dllib.html">DLlib User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DLlib/Overview/keras-api.html">Keras-Like API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DLlib/Overview/nnframes.html">Spark ML Pipeline Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Orca</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Orca/Overview/orca.html">Orca User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Orca/Overview/orca-context.html">Orca Context</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Orca/Overview/data-parallel-processing.html">Distributed Data Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Orca/Overview/distributed-training-inference.html">Distributed Training and Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Orca/Overview/distributed-tuning.html">Distributed Hyper-Parameter Tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Ray/Overview/ray.html">RayOnSpark</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Orca/Overview/known_issues.html">Orca Known Issues</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Chronos</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Chronos/Overview/chronos.html">Chronos User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Chronos/Overview/windows_guide.html">Windows User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Chronos/Overview/deep_dive.html">Chronos Deep Dive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Chronos/QuickStart/index.html">Chronos Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Chronos/Overview/chronos_known_issue.html">Chronos Known Issue</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PPML</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PPML/Overview/ppml.html">Privacy Preserving Machine Learning (PPML) User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PPML/Overview/trusted_big_data_analytics_and_ml.html">Trusted Big Data Analytics and ML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PPML/Overview/trusted_fl.html">Trusted FL (Federated Learning)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PPML/QuickStart/secure_your_services.html">Secure Your Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PPML/QuickStart/build_kernel_with_sgx.html">Building Linux Kernel from Source with SGX Enabled</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PPML/QuickStart/deploy_intel_sgx_device_plugin_for_kubernetes.html">Deploy the Intel SGX Device Plugin for Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PPML/QuickStart/trusted-serving-on-k8s-guide.html">Trusted Cluster Serving with Graphene on Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PPML/QuickStart/tpc-h_with_sparksql_on_k8s.html">TPC-H with Trusted SparkSQL on Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PPML/QuickStart/tpc-ds_with_sparksql_on_k8s.html">TPC-DS with Trusted SparkSQL on Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PPML/Overview/azure_ppml.html">Privacy Preserving Machine Learning (PPML) on Azure User Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Serving</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Overview/serving.html">Cluster Serving User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../QuickStart/serving-quickstart.html">Cluster Serving Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ProgrammingGuide/serving-installation.html">Install Cluster Serving</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ProgrammingGuide/serving-start.html">Start Cluster Serving</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ProgrammingGuide/serving-inference.html">Inference by Cluster Serving</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Cluster Serving Example</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#quick-start-example">Quick Start Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#end-to-end-example">End-to-end Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tfdataset">TFDataSet:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tokenizer">Tokenizer:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#imagedatagenerator">ImageDataGenerator:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#model-data-convert-guide">Model/Data Convert Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tensorflow">Tensorflow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#model-ckpt-to-savedmodel">Model - ckpt to savedModel</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tensorflow-all-version">tensorflow all version</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tensorflow-1-15">tensorflow &gt;= 1.15</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#model-keras-to-savedmodel">Model - Keras to savedModel</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tensorflow-2-0">tensorflow &gt; 2.0</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#model-ckpt-to-frozen-graph">Model - ckpt to Frozen Graph</a></li>
<li class="toctree-l3"><a class="reference internal" href="#notes-use-savedmodel">Notes - Use SavedModel</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data">Data</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../FAQ/faq.html">Cluster Serving FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FAQ/contribute-guide.html">Contribute to Cluster Serving</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Common Use Case</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Orca/QuickStart/orca-pytorch-distributed-quickstart.html">Use <code class="docutils literal notranslate"><span class="pre">torch.distributed</span></code> in Orca</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../UseCase/spark-dataframe.html">Use Spark Dataframe for Deep Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../UseCase/xshards-pandas.html">Use Distributed Pandas for Deep Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Orca/QuickStart/orca-autoestimator-pytorch-quickstart.html">Enable AutoML for PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Orca/QuickStart/orca-autoxgboost-quickstart.html">Use AutoXGBoost to auto-tune XGBoost parameters</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PythonAPI/Orca/orca.html">Orca API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PythonAPI/Friesian/feature.html">Friesian Feature API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PythonAPI/Chronos/index.html">Chronos API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PythonAPI/Nano/index.html">Nano API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Real-World Application</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Application/presentations.html">Presentations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Application/blogs.html">Blogs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Application/powered-by.html">Powered By</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">BigDL</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Cluster Serving Example</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/doc/Serving/Example/example.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="cluster-serving-example">
<h1>Cluster Serving Example<a class="headerlink" href="#cluster-serving-example" title="Permalink to this headline">¶</a></h1>
<p>There are some examples provided for new user or existing Tensorflow user.</p>
<section id="quick-start-example">
<h2>Quick Start Example<a class="headerlink" href="#quick-start-example" title="Permalink to this headline">¶</a></h2>
<p>Following is the recommended quick start example to transfer a local Keras application to Cluster Serving.</p>
<p><a class="reference external" href="https://github.com/intel-analytics/BigDL/blob/branch-2.0/docs/readthedocs/source/doc/Serving/Example/keras-to-cluster-serving-example.ipynb">keras-to-cluster-serving-example</a></p>
</section>
<section id="end-to-end-example">
<h2>End-to-end Example<a class="headerlink" href="#end-to-end-example" title="Permalink to this headline">¶</a></h2>
<section id="tfdataset">
<h3>TFDataSet:<a class="headerlink" href="#tfdataset" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/intel-analytics/bigdl/blob/branch-2.0/docs/docs/ClusterServingGuide/OtherFrameworkUsers/l08c08_forecasting_with_lstm.py">l08c08_forecasting_with_lstm.py</a></p>
</section>
<section id="tokenizer">
<h3>Tokenizer:<a class="headerlink" href="#tokenizer" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/intel-analytics/bigdl/tree/master/blob/branch-2.0/ClusterServingGuide/OtherFrameworkUsers/l10c03_nlp_constructing_text_generation_model.py">l10c03_nlp_constructing_text_generation_model.py</a></p>
</section>
<section id="imagedatagenerator">
<h3>ImageDataGenerator:<a class="headerlink" href="#imagedatagenerator" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/intel-analytics/bigdl/blob/branch-2.0/docs/docs/ClusterServingGuide/OtherFrameworkUsers/transfer_learning.py">transfer_learning.py</a></p>
</section>
</section>
<section id="model-data-convert-guide">
<h2>Model/Data Convert Guide<a class="headerlink" href="#model-data-convert-guide" title="Permalink to this headline">¶</a></h2>
<p>This guide is for users who:</p>
<ul class="simple">
<li><p>have written local code of Tensorflow, Pytorch(to be added)</p></li>
<li><p>have used specified data type of a specific framework, e.g. TFDataSet</p></li>
<li><p>want to deploy the local code on Cluster Serving but do not know how to write client code (Cluster Serving takes Numpy Ndarray as input, other types need to transform in advance).</p></li>
</ul>
<p>**If you have the above needs but fail to find the solution below, please <a class="reference external" href="https://github.com/intel-analytics/bigdl/issues">create issue here</a></p>
</section>
<section id="tensorflow">
<h2>Tensorflow<a class="headerlink" href="#tensorflow" title="Permalink to this headline">¶</a></h2>
<p>Model - includes savedModel, Frozen Graph (savedModel is recommended).</p>
<p>Data - includes <a class="reference external" href="#tfdataset">TFDataSet</a>, <a class="reference external" href="#tokenizer">Tokenizer</a>, <a class="reference external" href="#imagedatagenerator">ImageDataGenerator</a></p>
<p>Notes - includes tips to notice, includes <a class="reference external" href="#notes---use-savedmodel">savedModel tips</a></p>
<section id="model-ckpt-to-savedmodel">
<h3>Model - ckpt to savedModel<a class="headerlink" href="#model-ckpt-to-savedmodel" title="Permalink to this headline">¶</a></h3>
<section id="tensorflow-all-version">
<h4>tensorflow all version<a class="headerlink" href="#tensorflow-all-version" title="Permalink to this headline">¶</a></h4>
<p>This method works in all version of TF</p>
<p>You need to create the graph, get the output layer, create place holder for input, load the ckpt then save the model</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- code you need to write</span>
<span class="n">input_layer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">YourModel</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">output_layer</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">your_output_layer</span><span class="p">()</span>
<span class="c1"># --- code you need to write</span>
<span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
    <span class="n">saver</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">Saver</span><span class="p">()</span>
    <span class="n">saver</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">latest_checkpoint</span><span class="p">(</span><span class="n">FLAGS</span><span class="o">.</span><span class="n">ckpt_path</span><span class="p">))</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">simple_save</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span>
                               <span class="n">FLAGS</span><span class="o">.</span><span class="n">export_path</span><span class="p">,</span>
                               <span class="n">inputs</span><span class="o">=</span><span class="p">{</span>
                                   <span class="s1">&#39;input_layer&#39;</span><span class="p">:</span> <span class="n">input_layer</span>
                               <span class="p">},</span>
                               <span class="n">outputs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;output_layer&quot;</span><span class="p">:</span> <span class="n">output_layer</span><span class="p">})</span>
</pre></div>
</div>
</section>
<section id="tensorflow-1-15">
<h4>tensorflow &gt;= 1.15<a class="headerlink" href="#tensorflow-1-15" title="Permalink to this headline">¶</a></h4>
<p>This method works if you are familiar with savedModel signature, and tensorflow &gt;= 1.15</p>
<p>model graph could be load via <code class="docutils literal notranslate"><span class="pre">.meta</span></code>, and load ckpt then save the model, signature_def_map is required to provide</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># provide signature first</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">inputs</span><span class="p">)</span>
<span class="n">tensor_info_input</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">build_tensor_info</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">tensor_info_output</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">build_tensor_info</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>

<span class="n">prediction_signature</span> <span class="o">=</span> <span class="p">(</span>
  <span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">signature_def_utils</span><span class="o">.</span><span class="n">build_signature_def</span><span class="p">(</span>
      <span class="n">inputs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;x_input&#39;</span><span class="p">:</span> <span class="n">tensor_info_input</span><span class="p">},</span>
      <span class="n">outputs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;y_output&#39;</span><span class="p">:</span> <span class="n">tensor_info_output</span><span class="p">},</span>
      <span class="n">method_name</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">signature_constants</span><span class="o">.</span><span class="n">PREDICT_METHOD_NAME</span><span class="p">))</span>

      
<span class="c1"># Your ckpt file is prefix.meta, prefix.index, etc</span>
<span class="n">ckpt_prefix</span> <span class="o">=</span> <span class="s1">&#39;model/model.ckpt-xxxx&#39;</span>
<span class="n">export_dir</span> <span class="o">=</span> <span class="s1">&#39;saved_model&#39;</span>

<span class="n">loaded_graph</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
<span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">loaded_graph</span><span class="p">)</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
    <span class="c1"># load</span>
    <span class="n">loader</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">import_meta_graph</span><span class="p">(</span><span class="n">ckpt_prefix</span> <span class="o">+</span> <span class="s1">&#39;.meta&#39;</span><span class="p">)</span>
    <span class="n">loader</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">ckpt_prefix</span><span class="p">)</span>

    <span class="c1"># export</span>
    <span class="n">builder</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">SavedModelBuilder</span><span class="p">(</span><span class="n">export_dir</span><span class="p">)</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">add_meta_graph_and_variables</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span>
                                         <span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">tag_constants</span><span class="o">.</span><span class="n">TRAINING</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">tag_constants</span><span class="o">.</span><span class="n">SERVING</span><span class="p">],</span><span class="n">signature_def_map</span><span class="o">=</span><span class="p">{</span>
      <span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">signature_constants</span><span class="o">.</span><span class="n">DEFAULT_SERVING_SIGNATURE_DEF_KEY</span><span class="p">:</span>
          <span class="n">prediction_signature</span> 
      <span class="p">}</span>
    <span class="p">)</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="model-keras-to-savedmodel">
<h3>Model - Keras to savedModel<a class="headerlink" href="#model-keras-to-savedmodel" title="Permalink to this headline">¶</a></h3>
<section id="tensorflow-2-0">
<h4>tensorflow &gt; 2.0<a class="headerlink" href="#tensorflow-2-0" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;./model.h5&quot;</span><span class="p">)</span>
<span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;saved_model&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="model-ckpt-to-frozen-graph">
<h3>Model - ckpt to Frozen Graph<a class="headerlink" href="#model-ckpt-to-frozen-graph" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/intel-analytics/bigdl/tree/master/python/orca/example/freeze_checkpoint">freeze checkpoint example</a></p>
</section>
<section id="notes-use-savedmodel">
<h3>Notes - Use SavedModel<a class="headerlink" href="#notes-use-savedmodel" title="Permalink to this headline">¶</a></h3>
<p>If model has single tensor input, then nothing to notice.</p>
<p><strong>If model has multiple input, please notice following.</strong></p>
<p>When export, savedModel would store the inputs in alphabetical order. Use <code class="docutils literal notranslate"><span class="pre">saved_model_cli</span> <span class="pre">show</span> <span class="pre">--dir</span> <span class="pre">.</span> <span class="pre">--all</span></code> to see the order. e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">signature_def</span><span class="p">[</span><span class="s1">&#39;serving_default&#39;</span><span class="p">]:</span>
  <span class="n">The</span> <span class="n">given</span> <span class="n">SavedModel</span> <span class="n">SignatureDef</span> <span class="n">contains</span> <span class="n">the</span> <span class="n">following</span> <span class="nb">input</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;id1&#39;</span><span class="p">]</span> <span class="n">tensor_info</span><span class="p">:</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="n">DT_INT32</span>
        <span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">id1</span><span class="p">:</span><span class="mi">0</span>
    <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;id2&#39;</span><span class="p">]</span> <span class="n">tensor_info</span><span class="p">:</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="n">DT_INT32</span>
        <span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">id2</span><span class="p">:</span><span class="mi">0</span>
</pre></div>
</div>
<p>when enqueue to Cluster Serving, follow this order</p>
</section>
<section id="data">
<h3>Data<a class="headerlink" href="#data" title="Permalink to this headline">¶</a></h3>
<p>To transform following data type to Numpy Ndarray, following examples are provided</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../ProgrammingGuide/serving-inference.html" class="btn btn-neutral float-left" title="Inference by Cluster Serving" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../FAQ/faq.html" class="btn btn-neutral float-right" title="Cluster Serving FAQ" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, BigDL Authors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>