<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Orca Context &mdash; BigDL  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
        <script src="../../../_static/design-tabs.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Distributed Data Processing" href="data-parallel-processing.html" />
    <link rel="prev" title="The Orca Library" href="orca.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> BigDL
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Quick Start</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../QuickStart/orca-tf-quickstart.html">TensorFlow 1.15 Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../QuickStart/orca-keras-quickstart.html">Keras 2.3 Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../QuickStart/orca-tf2keras-quickstart.html">TensorFlow 2 Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../QuickStart/orca-pytorch-quickstart.html">PyTorch Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Ray/QuickStart/ray-quickstart.html">RayOnSpark Quickstart</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../UserGuide/python.html">Python User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../UserGuide/scala.html">Scala User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../UserGuide/colab.html">Colab User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../UserGuide/docker.html">Docker User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../UserGuide/hadoop.html">Hadoop/YARN User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../UserGuide/k8s.html">K8s User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../UserGuide/databricks.html">Databricks User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../UserGuide/develop.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../UserGuide/known_issues.html">BigDL Known Issues</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Nano</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Nano/Overview/nano.html">Nano User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Nano/Overview/windows_guide.html">Windows User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Nano/QuickStart/pytorch_train.html">BigDL-Nano PyTorch Training Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Nano/QuickStart/pytorch_inference.html">BigDL-Nano PyTorch Inference Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Nano/QuickStart/tensorflow_train.html">BigDL-Nano TensorFlow Training Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Nano/QuickStart/tensorflow_inference.html">BigDL-Nano TensorFlow Inference Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Nano/QuickStart/hpo.html">AutoML Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Nano/Overview/known_issues.html">Nano Known Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Nano/QuickStart/index.html">Nano Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">DLlib</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../DLlib/Overview/dllib.html">DLlib User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DLlib/Overview/keras-api.html">Keras-Like API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DLlib/Overview/nnframes.html">Spark ML Pipeline Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Orca</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="orca.html">Orca User Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Orca Context</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#initialization"><strong>1. Initialization</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#python-dependencies"><strong>2. Python Dependencies</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#execution-engine"><strong>3. Execution Engine</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#extra-configurations"><strong>4. Extra Configurations</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#termination"><strong>5. Termination</strong></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="data-parallel-processing.html">Distributed Data Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed-training-inference.html">Distributed Training and Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed-tuning.html">Distributed Hyper-Parameter Tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Ray/Overview/ray.html">RayOnSpark</a></li>
<li class="toctree-l1"><a class="reference internal" href="known_issues.html">Orca Known Issues</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Chronos</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Chronos/Overview/chronos.html">Chronos User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Chronos/Overview/deep_dive.html">Chronos Deep Dive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Chronos/QuickStart/index.html">Chronos Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Chronos/Overview/chronos_known_issue.html">Chronos Known Issue</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PPML</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PPML/Overview/ppml.html">Privacy Preserving Machine Learning (PPML) User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PPML/Overview/trusted_big_data_analytics_and_ml.html">Trusted Big Data Analytics and ML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PPML/Overview/trusted_fl.html">Trusted FL (Federated Learning)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PPML/QuickStart/secure_your_services.html">Secure Your Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PPML/QuickStart/build_kernel_with_sgx.html">Building Linux Kernel from Source with SGX Enabled</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PPML/QuickStart/deploy_intel_sgx_device_plugin_for_kubernetes.html">Deploy the Intel SGX Device Plugin for Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PPML/QuickStart/trusted-serving-on-k8s-guide.html">Trusted Cluster Serving with Graphene on Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PPML/QuickStart/tpc-h_with_sparksql_on_k8s.html">TPC-H with Trusted SparkSQL on Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PPML/QuickStart/tpc-ds_with_sparksql_on_k8s.html">TPC-DS with Trusted SparkSQL on Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PPML/Overview/azure_ppml.html">Privacy Preserving Machine Learning (PPML) on Azure User Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Serving</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Serving/Overview/serving.html">Cluster Serving User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Serving/QuickStart/serving-quickstart.html">Cluster Serving Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Serving/ProgrammingGuide/serving-installation.html">Install Cluster Serving</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Serving/ProgrammingGuide/serving-start.html">Start Cluster Serving</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Serving/ProgrammingGuide/serving-inference.html">Inference by Cluster Serving</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Serving/Example/example.html">Cluster Serving Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Serving/FAQ/faq.html">Cluster Serving FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Serving/FAQ/contribute-guide.html">Contribute to Cluster Serving</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Common Use Case</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../QuickStart/orca-pytorch-distributed-quickstart.html">Use <code class="docutils literal notranslate"><span class="pre">torch.distributed</span></code> in Orca</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../UseCase/spark-dataframe.html">Use Spark Dataframe for Deep Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../UseCase/xshards-pandas.html">Use Distributed Pandas for Deep Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../QuickStart/orca-autoestimator-pytorch-quickstart.html">Enable AutoML for PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../QuickStart/orca-autoxgboost-quickstart.html">Use AutoXGBoost to auto-tune XGBoost parameters</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../PythonAPI/Orca/orca.html">Orca API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PythonAPI/Friesian/feature.html">Friesian Feature API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PythonAPI/Chronos/index.html">Chronos API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PythonAPI/Nano/index.html">Nano API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Real-World Application</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Application/presentations.html">Presentations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Application/blogs.html">Blogs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Application/powered-by.html">Powered By</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">BigDL</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Orca Context</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/doc/Orca/Overview/orca-context.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="orca-context">
<h1>Orca Context<a class="headerlink" href="#orca-context" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<p><code class="docutils literal notranslate"><span class="pre">OrcaContext</span></code> is the main entry for provisioning the Orca program on the underlying cluster (such as K8s or Hadoop cluster), or just on a single laptop.</p>
<hr class="docutils" />
<section id="initialization">
<h2><strong>1. Initialization</strong><a class="headerlink" href="#initialization" title="Permalink to this headline">¶</a></h2>
<p>An Orca program usually starts with the initialization of <code class="docutils literal notranslate"><span class="pre">OrcaContext</span></code> as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bigdl.orca</span> <span class="kn">import</span> <span class="n">init_orca_context</span>

<span class="n">init_orca_context</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>In <code class="docutils literal notranslate"><span class="pre">init_orca_context</span></code>, the user may specify necessary runtime configurations for the Orca program, including:</p>
<ul class="simple">
<li><p><em>Cluster mode</em>: Users can specify the computing environment for the program (a local machine, K8s cluster, Hadoop/YARN cluster, etc.).</p></li>
<li><p><em>Runtime</em>: Users can specify the backend for the program (spark and ray, etc.) to create SparkContext and/or RayContext, the cluster mode would work based on the specified runtime backend.</p></li>
<li><p><em>Physical resources</em>: Users can specify the amount of physical resources to be allocated for the program on the underlying cluster, including the number of nodes in the cluster, the cores and memory allocated for each node, etc.</p></li>
</ul>
<p>The Orca program simply runs <code class="docutils literal notranslate"><span class="pre">init_orca_context</span></code> on the local machine, which will automatically provision the runtime Python environment and distributed execution engine on the underlying computing environment (such as a single laptop, a large K8s or Hadoop cluster, etc.).</p>
<p>View the related <a class="reference external" href="#">Python API doc</a> for more details.</p>
</section>
<hr class="docutils" />
<section id="python-dependencies">
<h2><strong>2. Python Dependencies</strong><a class="headerlink" href="#python-dependencies" title="Permalink to this headline">¶</a></h2>
<p>A key challenge for scaling out Python program across a distributed cluster is how to properly install the required Python environment (libraries and dependencies) on each node in the cluster (preferably in an automatic and dynamic fashion).</p>
<p>For K8s cluster, the user may install required Python packages in the container and specify the <code class="docutils literal notranslate"><span class="pre">container_image</span></code> argument when <code class="docutils literal notranslate"><span class="pre">init_orca_context</span></code>. For Hadoop/YARN cluster, the user may use <code class="docutils literal notranslate"><span class="pre">conda</span></code> to create the Python virtual environment with required dependencies on the local machine, and <code class="docutils literal notranslate"><span class="pre">init_orca_context</span></code> will automatically detect the active <code class="docutils literal notranslate"><span class="pre">conda</span></code> environment and provision it on each node in the cluster.</p>
<p>You can also add .py, .zip or .egg files to distribute with your application by specifying <code class="docutils literal notranslate"><span class="pre">extra_python_lib</span></code> in <code class="docutils literal notranslate"><span class="pre">init_orca_context</span></code>. If you depend on multiple Python files we recommend packaging them into a .zip or .egg. Those files will be added to each node’s python search path.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">init_orca_context</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">extra_python_lib</span><span class="o">=</span><span class="s2">&quot;func1.py,func2.py,lib3.zip&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>View the user guide for <a class="reference internal" href="../../UserGuide/k8s.html"><span class="doc">K8s</span></a> and <a class="reference internal" href="../../UserGuide/hadoop.html"><span class="doc">Hadoop/YARN</span></a> for more details.</p>
</section>
<hr class="docutils" />
<section id="execution-engine">
<h2><strong>3. Execution Engine</strong><a class="headerlink" href="#execution-engine" title="Permalink to this headline">¶</a></h2>
<p>Under the hood, <code class="docutils literal notranslate"><span class="pre">OrcaContext</span></code> will automatically provision Apache Spark and/or Ray as the underlying execution engine for the distributed data processing and model training/inference.</p>
<p>Users can easily retrieve <code class="docutils literal notranslate"><span class="pre">SparkContext</span></code> and <code class="docutils literal notranslate"><span class="pre">RayContext</span></code>, the main entry point for Spark and Ray respectively, via <code class="docutils literal notranslate"><span class="pre">OrcaContext</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bigdl.orca</span> <span class="kn">import</span> <span class="n">OrcaContext</span>

<span class="n">sc</span> <span class="o">=</span> <span class="n">OrcaContext</span><span class="o">.</span><span class="n">get_spark_context</span><span class="p">()</span>
<span class="n">ray_ctx</span> <span class="o">=</span> <span class="n">OrcaContext</span><span class="o">.</span><span class="n">get_ray_context</span><span class="p">()</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="extra-configurations">
<h2><strong>4. Extra Configurations</strong><a class="headerlink" href="#extra-configurations" title="Permalink to this headline">¶</a></h2>
<p>Users can make extra configurations when using the functionalities of Project Orca via <code class="docutils literal notranslate"><span class="pre">OrcaContext</span></code>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">OrcaContext.log_output</span></code>: Default to be False. <code class="docutils literal notranslate"><span class="pre">OrcaContext.log_output</span> <span class="pre">=</span> <span class="pre">True</span></code> is recommended when running Jupyter notebook (this will display all the program output in the notebook). Make sure you set it before <code class="docutils literal notranslate"><span class="pre">init_orca_context</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OrcaContext.serialize_data_creator</span></code>: Default to be False. <code class="docutils literal notranslate"><span class="pre">OrcaContext.serialize_data_creator</span> <span class="pre">=</span> <span class="pre">True</span></code> would add a file lock when initializing data for distributed training (this may be useful if you run multiple workers on a single node and they download data to the same destination).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OrcaContext.pandas_read_backend</span></code>: The backend to be used for reading data as Panda DataFrame. Default to be “spark”. See <a class="reference external" href="./data-parallel-processing.html#data-parallel-pandas">here</a> for more details.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OrcaContext.train_data_store</span></code>: Default to be “DRAM”. <code class="docutils literal notranslate"><span class="pre">OrcaContext.train_data_store</span> <span class="pre">=</span> <span class="pre">&quot;DISK_n&quot;</span></code> (e.g., “DISK_2”) if the training data cannot fit in memory (this will store the data on disk, and cache only 1/n of the data in memory; after going through the 1/n, it will release the current cache, and load another 1/n into memory). Currently it works for TensorFlow and Keras Estimators only.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OrcaContext.barrier_mode</span></code>: Whether to use Spark barrier execution mode to launch Ray. Default to be True. You can set it to be False if you are using Spark below 2.4 or you need to have dynamic allocation enabled.</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="termination">
<h2><strong>5. Termination</strong><a class="headerlink" href="#termination" title="Permalink to this headline">¶</a></h2>
<p>After the Orca program finishes, the user can call <code class="docutils literal notranslate"><span class="pre">stop_orca_context</span></code> to release resources and shut down the underlying Spark and/or Ray execution engine.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bigdl.orca</span> <span class="kn">import</span> <span class="n">stop_orca_context</span>

<span class="n">stop_orca_context</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="orca.html" class="btn btn-neutral float-left" title="The Orca Library" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="data-parallel-processing.html" class="btn btn-neutral float-right" title="Distributed Data Processing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, BigDL Authors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>