# Deploy PPML (Privacy Preserving Machine Learning) Applications in the Production Environment

PPML applications built on Intel SGX are quite different from normal machine learning applications during deployment. Because, Intel SGX requires applications to be signed by a user-specified key, i.e., `enclave-key`. This requirement helps SGX applications ensure their integrity and build trust. However, it also separates PPML deployment into 2 stages:

1. Test & Development with BigDL PPML. In this stage, we focus on functionality and performance. User/customer can use a randomly generated key or a user-specified key for signing, development and testing.
2. Build & Deployment. In this stage, we focus more on safety and security. That means we have to separate signing out of deployment.
* Build & sign applications with enclave-key.
* Deploy applications.

Due to security and privacy considerations, only stage 1 is fully covered by BigDL PPML image. Customers/users need to handle Stage 2 carefully by themselves.

![](../images/ppml_sgx_enclave.png)

## 0. Prerequisite

* BigDL PPML image, e.g., `intelanalytics/bigdl-ppml-trusted-big-data-ml-python-graphene` or `intelanalytics/bigdl-ppml-trusted-big-data-ml-scala-occlum`.
* Secured environment for signing applications & Build image. This environment has access to `enclave-key` and can build image based on BigDL PPML image.
* `enclave-key` for signing SGX applications. It should be generated by RSA, with at least [2048 bits](https://en.wikipedia.org/wiki/RSA_numbers#RSA-2048).

![](../images/ppml_scope.png)

## 1. Test & Development with PPML image

BigDL PPML provides necessary dependencies for building, signing, debugging and testing SGX applications. In this stage, we recommend using a random key (RSA-2048) provided by BigDL PPML. This key will be used for building & signing SGX enclave. The whole workflow is as follows:

1. Configurations
2. Build & Sign SGX enclave with key
3. Run applications

![](../images/ppml_test_dev.png)


## 2. Build & Deployment your applications

![](../images/ppml_build_deploy.png)

### Sign applications & Build your image

Note that: `enclave-key` is related to `mr_signer` and `mr_enclave`.



### Deploy applications

## References

1. [Intel SGX (Software Guard Extensions)](https://www.intel.com/content/www/us/en/developer/tools/software-guard-extensions/overview.html)
2. 